---
import type { LeagueStanding } from '../types';

interface Props {
  standings: LeagueStanding[] | null;
}

const { standings } = Astro.props;
---

<style>
  .leaderboard {
    background: white;
    border-radius: 16px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    overflow: hidden;
  }

  .leaderboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1.5rem 2rem;
    display: grid;
    grid-template-columns: 60px 1fr 80px 100px 180px 180px;
    gap: 1rem;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .leaderboard-header > div {
    text-align: left;
  }

  .leaderboard-row {
    padding: 1.5rem 2rem;
    display: grid;
    grid-template-columns: 60px 1fr 80px 100px 180px 180px;
    gap: 1rem;
    align-items: center;
    border-bottom: 1px solid #e0e0e0;
    transition: background-color 0.2s ease;
  }

  .leaderboard-row:hover {
    background-color: #f5f5f5;
  }

  .leaderboard-row:last-child {
    border-bottom: none;
  }

  .rank {
    font-size: 1.5rem;
    font-weight: 700;
    color: #667eea;
    text-align: left;
  }

  .rank-1 { color: #FFD700; font-size: 2rem; }
  .rank-2 { color: #C0C0C0; font-size: 1.8rem; }
  .rank-3 { color: #CD7F32; font-size: 1.6rem; }

  .player-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: #333;
  }

  .player-username {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.25rem;
  }

  .stat {
    text-align: left;
    font-weight: 500;
  }

  .stat-value {
    font-size: 1.1rem;
    color: #333;
  }

  .stat-label {
    font-size: 0.75rem;
    color: #999;
    text-transform: uppercase;
    margin-top: 0.25rem;
  }

  .points {
    font-size: 1.3rem;
    font-weight: 700;
    color: #667eea;
  }

  .record {
    font-family: 'Courier New', monospace;
    font-size: 0.95rem;
    color: #555;
  }

  .percent-label {
    font-size: 0.85rem;
    color: #888;
    margin-top: 0.25rem;
    font-weight: 500;
  }

  .wp-high { color: #10B981; }
  .wp-medium { color: #F59E0B; }
  .wp-low { color: #EF4444; }

  .no-data {
    text-align: center;
    padding: 4rem 2rem;
    color: #666;
  }

  .no-data h2 {
    color: #333;
    margin-bottom: 1rem;
  }

  .no-data p {
    color: #666;
    font-size: 1.1rem;
  }

  .no-data code {
    background: #f0f0f0;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
  }

  @media (max-width: 1024px) {
    .leaderboard-header,
    .leaderboard-row {
      grid-template-columns: 50px 1fr 60px 80px 140px;
      gap: 0.5rem;
      padding: 1rem;
    }

    /* Hide Games column on medium screens */
    .stat:nth-child(6) {
      display: none;
    }
  }

  @media (max-width: 640px) {
    .leaderboard-header,
    .leaderboard-row {
      grid-template-columns: 35px 1fr 55px 90px;
      padding: 1rem 0.75rem;
      gap: 0.5rem;
      font-size: 0.8rem;
    }

    .leaderboard-header {
      font-size: 0.7rem;
      line-height: 1.2;
    }

    .leaderboard-header > div {
      white-space: normal;
      word-break: break-word;
    }

    /* Hide Events and Games columns on mobile */
    .stat:nth-child(3),
    .stat:nth-child(6) {
      display: none;
    }

    /* Hide Events and Games headers on mobile */
    .leaderboard-header > div:nth-child(3),
    .leaderboard-header > div:nth-child(6) {
      display: none;
    }

    .rank {
      font-size: 1.2rem;
    }

    .rank-1 { font-size: 1.4rem; }
    .rank-2 { font-size: 1.3rem; }
    .rank-3 { font-size: 1.25rem; }

    .player-name {
      font-size: 0.95rem;
    }

    .player-username {
      font-size: 0.7rem;
    }

    .record {
      font-size: 0.8rem;
    }

    .percent-label {
      font-size: 0.65rem;
    }
  }
</style>

<div class="leaderboard">
  {standings ? (
    <Fragment>
      <div class="leaderboard-header">
        <div>Rank</div>
        <div>Player</div>
        <div>Events</div>
        <div>Points</div>
        <div>Matches (MWP)</div>
        <div>Games (GWP)</div>
      </div>

      {standings.map((standing) => {
        const player = standing.Team.Players[0];
        const isTopThree = standing.Rank < 4;
        const rankClass = isTopThree ? `rank-${standing.Rank}` : '';

        // Calculate match win percentage with color treatment
        const totalMatches = standing.MatchWins + standing.MatchLosses + standing.MatchDraws;
        const mwPercent = totalMatches > 0 ? (standing.MatchWins / totalMatches * 100).toFixed(1) : '0.0';
        const mwPercentNum = totalMatches > 0 ? (standing.MatchWins / totalMatches) : 0;
        const isHighMWP = mwPercentNum > 0.59;
        const isMediumMWP = mwPercentNum > 0.39;
        const mwClass = isHighMWP ? 'wp-high' : (isMediumMWP ? 'wp-medium' : 'wp-low');

        // Calculate game win percentage with color treatment
        const gwPercent = (standing.TeamGameWinPercentage * 100).toFixed(1);
        const isHighGWP = standing.TeamGameWinPercentage > 0.59;
        const isMediumGWP = standing.TeamGameWinPercentage > 0.39;
        const gwClass = isHighGWP ? 'wp-high' : (isMediumGWP ? 'wp-medium' : 'wp-low');

        return (
          <div class="leaderboard-row">
            <div class={`rank ${rankClass}`}>{standing.Rank}</div>
            <div>
              <div class="player-name">{player.DisplayName}</div>
              <div class="player-username">@{player.Username}</div>
            </div>
            <div class="stat">
              <div class="stat-value">{standing.TournamentCount || 0}</div>
            </div>
            <div class="stat">
              <div class="points">{standing.Points}</div>
            </div>
            <div class="stat">
              <div class="record">{standing.MatchRecord}</div>
              <div class={`percent-label ${mwClass}`}>({mwPercent}%)</div>
            </div>
            <div class="stat">
              <div class="record">{standing.GameRecord}</div>
              <div class={`percent-label ${gwClass}`}>({gwPercent}%)</div>
            </div>
          </div>
        );
      })}
    </Fragment>
  ) : (
    <div class="no-data">
      <h2>No League Data Available</h2>
      <p>Run the league aggregator to generate standings:</p>
      <p><code>npm run league 384681 382756</code></p>
    </div>
  )}
</div>
