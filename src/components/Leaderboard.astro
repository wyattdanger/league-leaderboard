---
interface LeagueStanding {
  TeamId: number;
  Team: {
    Players: Array<{
      DisplayName: string;
      Username: string;
    }>;
  };
  Rank: number;
  MatchWins: number;
  MatchLosses: number;
  MatchDraws: number;
  GameWins: number;
  GameLosses: number;
  GameDraws: number;
  Points: number;
  MatchRecord: string;
  GameRecord: string;
  OpponentMatchWinPercentage: number;
  TeamGameWinPercentage: number;
  OpponentGameWinPercentage: number;
  OpponentCount: number;
  TournamentCount?: number;
}

interface Props {
  standings: LeagueStanding[] | null;
}

const { standings } = Astro.props;
---

<div class="leaderboard">
  {standings ? (
    <Fragment>
      <div class="leaderboard-header">
        <div>Rank</div>
        <div>Player</div>
        <div>Events</div>
        <div>Points</div>
        <div>Matches (MWP)</div>
        <div>Games (GWP)</div>
      </div>

      {standings.map((standing) => {
        const player = standing.Team.Players[0];
        const isTopThree = standing.Rank < 4;
        const rankClass = isTopThree ? `rank-${standing.Rank}` : '';

        // Calculate match win percentage
        const totalMatches = standing.MatchWins + standing.MatchLosses + standing.MatchDraws;
        const mwPercent = totalMatches > 0 ? (standing.MatchWins / totalMatches * 100).toFixed(1) : '0.0';

        // Calculate game win percentage with color treatment
        const gwPercent = (standing.TeamGameWinPercentage * 100).toFixed(1);
        const isHighGWP = standing.TeamGameWinPercentage > 0.59;
        const isMediumGWP = standing.TeamGameWinPercentage > 0.39;
        const gwClass = isHighGWP ? 'wp-high' : (isMediumGWP ? 'wp-medium' : 'wp-low');

        return (
          <div class="leaderboard-row">
            <div class={`rank ${rankClass}`}>{standing.Rank}</div>
            <div>
              <div class="player-name">{player.DisplayName}</div>
              <div class="player-username">@{player.Username}</div>
            </div>
            <div class="stat">
              <div class="stat-value">{standing.TournamentCount || 0}</div>
            </div>
            <div class="stat">
              <div class="points">{standing.Points}</div>
            </div>
            <div class="stat">
              <div class="record">{standing.MatchRecord}</div>
              <div class="percent-label">({mwPercent}%)</div>
            </div>
            <div class="stat">
              <div class="record">{standing.GameRecord}</div>
              <div class={`percent-label ${gwClass}`}>({gwPercent}%)</div>
            </div>
          </div>
        );
      })}
    </Fragment>
  ) : (
    <div class="no-data">
      <h2>No League Data Available</h2>
      <p>Run the league aggregator to generate standings:</p>
      <p><code>npm run league 384681 382756</code></p>
    </div>
  )}
</div>
