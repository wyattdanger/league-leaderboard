---
import type { PlayerLeagueStats } from '../types';

interface Props {
  leagueStats: PlayerLeagueStats[];
}

const { leagueStats } = Astro.props;

// Filter out Top 8 tournaments from league stats display
const regularLeagueStats = leagueStats.filter((stats) => !stats.leagueName.endsWith(' Top 8'));
---

<div class="league-stats-container">
  <div class="league-stats-header">League Performance</div>

  <div class="league-stats-grid">
    {
      regularLeagueStats.map((stats) => {
        const mwPercentNum = stats.matchWinPercentage;
        const isHighMWP = mwPercentNum > 0.59;
        const isMediumMWP = mwPercentNum > 0.39;
        const mwClass = isHighMWP ? 'wp-high' : isMediumMWP ? 'wp-medium' : 'wp-low';

        const gwPercentNum = stats.gameWinPercentage;
        const isHighGWP = gwPercentNum > 0.59;
        const isMediumGWP = gwPercentNum > 0.39;
        const gwClass = isHighGWP ? 'wp-high' : isMediumGWP ? 'wp-medium' : 'wp-low';

        return (
          <div class="league-card">
            <div class="league-name">{stats.leagueName}</div>
            <div class="stats-row">
              <div class="stat-item">
                <div class="stat-label">Events</div>
                <div class="stat-value">{stats.events}</div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Points</div>
                <div class="stat-value">{stats.points}</div>
              </div>
            </div>
            <div class="stats-row">
              <div class="stat-item">
                <div class="stat-label">Matches</div>
                <div class="stat-value">{stats.matchRecord}</div>
                <div class={`percent ${mwClass}`}>
                  ({(stats.matchWinPercentage * 100).toFixed(1)}%)
                </div>
              </div>
              <div class="stat-item">
                <div class="stat-label">Games</div>
                <div class="stat-value">{stats.gameRecord}</div>
                <div class={`percent ${gwClass}`}>
                  ({(stats.gameWinPercentage * 100).toFixed(1)}%)
                </div>
              </div>
            </div>
          </div>
        );
      })
    }
  </div>
</div>

<style>
  .league-stats-container {
    margin-bottom: 2rem;
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .league-stats-header {
    padding: 1rem 1.5rem;
    background: var(--gradient-primary);
    color: white;
    font-weight: 600;
    font-size: 1rem;
  }

  .league-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    padding: 1rem;
  }

  .league-card {
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .league-name {
    font-size: 1rem;
    font-weight: 600;
    color: #764ba2;
    background: #f9fafb;
    padding: 0.75rem 1rem;
    text-align: center;
    border-bottom: 1px solid #e5e7eb;
  }

  .stats-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #f3f4f6;
  }

  .stats-row:last-child {
    border-bottom: none;
  }

  .stat-item {
    text-align: center;
  }

  .stat-label {
    font-size: 0.75rem;
    color: #6b7280;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.25rem;
  }

  .stat-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 0.15rem;
  }

  .percent {
    font-size: 0.85rem;
    font-weight: 600;
  }

  .wp-high {
    color: #10b981;
  }
  .wp-medium {
    color: #f59e0b;
  }
  .wp-low {
    color: #ef4444;
  }

  @media (max-width: 640px) {
    h2 {
      font-size: 1.25rem;
    }

    .league-stats-grid {
      grid-template-columns: 1fr;
      padding: 0.5rem;
      gap: 1rem;
    }

    .league-card {
      padding: 1rem;
    }

    .league-name {
      font-size: 1.1rem;
    }

    .stat-value {
      font-size: 1.1rem;
    }
  }
</style>
