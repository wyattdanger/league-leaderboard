---
import LeaguePage from '../components/LeaguePage.astro';
import { loadLeaguesConfig, loadLeagueStandings } from '../utils/data';
import { getTournamentMetadata } from '../utils/tournamentData';
import type { TournamentMetadata } from '../types';

const config = loadLeaguesConfig();
const allLeagues = config.leagues;
const firstLeague = allLeagues[0];

// Load standings for the first league
const standings = loadLeagueStandings(firstLeague.name);

// Load tournament metadata for the first league
const tournamentMetadata: TournamentMetadata[] = firstLeague.tournaments
  .map((id) => getTournamentMetadata(id))
  .filter((meta): meta is TournamentMetadata => meta !== null);

// Show Top 8 if league has one, otherwise show latest event
const top8Tournament = firstLeague.top8Tournament
  ? getTournamentMetadata(firstLeague.top8Tournament)
  : null;
const showLatestEvent = !top8Tournament;
---

<LeaguePage
  currentLeague={firstLeague}
  allLeagues={allLeagues}
  isOverall={false}
  standings={standings}
  tournaments={tournamentMetadata}
  showLatestEvent={showLatestEvent}
  top8Tournament={top8Tournament}
/>
